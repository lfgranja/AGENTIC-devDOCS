# Architecture of AGENTIC-devDOCS Automation Tools

This document outlines the architecture, data flow, and internal structure of the automation tools within the `AGENTIC-devDOCS` project, specifically focusing on `generate_docs.py` and `create_issues.py`, and their interaction with `config.py`.

## 1. Overview

The `AGENTIC-devDOCS` project utilizes a set of Python scripts to automate the generation of development documentation and the creation of GitHub issues. This automation streamlines the post-Pull Request (PR) process, ensuring that lessons learned, future work, and identified issues are systematically captured and managed.

## 2. Core Components

### 2.1. `generate_docs.py`

**Purpose:** This script is responsible for analyzing code changes associated with a PR or branch and generating three key Markdown documentation files:

*   `LESSONS_LEARNED{PR_SUFFIX}.md`: Captures technical challenges, design decisions, and unexpected issues.
*   `FUTURE_WORK_TODO{PR_SUFFIX}.md`: Documents areas for improvement, potential optimizations, and ideas for extension.
*   `ISSUES_TO_CREATE{PR_SUFFIX}.md`: Lists potential GitHub issues that should be created based on the work done.

**Inputs:**

*   `--changed-files` (Path to a file listing changed file paths)
*   `--output-dir` (Directory where generated documentation files will be saved)
*   `--branch` (Name of the current branch)
*   `--pr-number` (Optional: PR number, used for file naming)
*   `--openai-api-key` (OpenAI API key for content generation)
*   `--config` (Optional: Path to a configuration file)

**Internal Structure & Process:**

1.  **Configuration Loading**: Utilizes `config.ConfigManager` to load settings. Command-line arguments take precedence over configuration file values.
2.  **`DocumentationGenerator` Class**: Encapsulates the core logic.
    *   **`get_changed_files()`**: Reads a list of file paths from the provided `--changed-files` input.
    *   **`analyze_changes()`**: Categorizes the changed files into types (features, fixes, refactorings, tests, documentation, dependencies) using simple heuristics (file extensions and keyword matching within file content).
    *   **`_call_openai()`**: A private method that interacts with the OpenAI API (specifically `gpt-3.5-turbo`) to generate the content for the documentation files. It constructs prompts based on the analysis results and predefined templates.
    *   **`generate_lessons_learned()`, `generate_future_work()`, `generate_issues_to_create()`**: Methods that prepare specific prompts and call `_call_openai()` to get the generated content.
    *   **`generate_all_documentation()`**: Orchestrates the entire documentation generation process, creating the output directory and saving the generated Markdown files.

**Outputs:**

*   `LESSONS_LEARNED{PR_SUFFIX}.md`
*   `FUTURE_WORK_TODO{PR_SUFFIX}.md`
*   `ISSUES_TO_CREATE{PR_SUFFIX}.md`

### 2.2. `create_issues.py`

**Purpose:** This script reads the `ISSUES_TO_CREATE{PR_NUMBER}.md` file (generated by `generate_docs.py`) and automatically creates corresponding GitHub issues in the specified repository.

**Inputs:**

*   `--token` (GitHub Personal Access Token)
*   `--repo` (Repository name in `owner/repo` format)
*   `--pr` (PR number associated with the `ISSUES_TO_CREATE` file)
*   `--issues-file` (Path to the `ISSUES_TO_CREATE{PR_NUMBER}.md` file)

**Internal Structure & Process:**

1.  **`IssueCreator` Class**: Encapsulates the core logic.
    *   **Initialization**: Connects to the GitHub API using the provided token and repository name via the `PyGithub` library.
    *   **`parse_issues_from_file()`**: Reads the `ISSUES_TO_CREATE{PR_NUMBER}.md` file and extracts individual issue details (title, description, labels, milestone, priority, complexity, context) using regular expressions.
    *   **`_parse_issue_section()`**: A private helper method to parse a single issue section from the Markdown content.
    *   **`validate_labels()`**: Checks if extracted labels exist in the GitHub repository and filters out invalid ones. It also dynamically adds `priority:{level}` and `complexity:{level}` as labels if specified in the documentation.
    *   **`get_milestone_number()`**: Retrieves the numerical ID of a GitHub milestone based on its title.
    *   **`create_issue()`**: Creates a new GitHub issue using the `PyGithub` library, populating its title, body (including context and a reference to the PR), labels, and milestone.
    *   **`create_issues_from_pr()`**: Orchestrates the issue creation process, parsing all issues from the file and calling `create_issue()` for each.
    *   **`update_documentation()`**: After issues are created, this method appends a section to the original `ISSUES_TO_CREATE{PR_NUMBER}.md` file, listing the newly created GitHub issues with their numbers and URLs.

**Outputs:**

*   New GitHub issues created in the target repository.
*   Updated `ISSUES_TO_CREATE{PR_NUMBER}.md` file with links to the created issues.

### 2.3. `config.py` (ConfigManager)

**Purpose:** Provides a standardized way to load and manage configuration settings for the automation tools.

**Internal Structure & Process:**

1.  **`ConfigManager` Class**: Handles configuration logic.
    *   **`load_config()`**: Reads configuration from a specified file path. Supports both JSON (`.json`) and YAML (`.yml`, `.yaml`) formats. If no file is found, it proceeds with default (empty) settings.
    *   **`get()` and `get_nested()`**: Methods for safely retrieving configuration values, including nested ones using dot notation.
    *   **`find_config_file()`**: A static method that searches for configuration files in common locations (e.g., current directory, user's home directory) using predefined filenames (e.g., `.agentic-config.json`, `agentic-config.yaml`).

**Used by:** `generate_docs.py` (and potentially other future scripts) to externalize and manage operational parameters.

## 3. Data Flow and Interactions

```mermaid
graph TD
    A[Changed Files List] --> B(generate_docs.py)
    C[Configuration File] --> B
    B --> D(OpenAI API)
    D --> B
    B --> E[LESSONS_LEARNED.md]
    B --> F[FUTURE_WORK_TODO.md]
    B --> G[ISSUES_TO_CREATE.md]
    G --> H(create_issues.py)
    I[GitHub Token & Repo Name] --> H
    H --> J(GitHub API)
    J --> H
    H --> K[New GitHub Issues]
    H --> G_updated[ISSUES_TO_CREATE.md (Updated)]

    subgraph Configuration
        C
    end

    subgraph Documentation Generation
        B
        D
        E
        F
        G
    end

    subgraph Issue Creation
        H
        I
        J
        K
        G_updated
    end
```

**Sequence of Operations:**

1.  A list of changed files (e.g., from a Git diff) is provided to `generate_docs.py`.
2.  `generate_docs.py` loads its configuration (potentially from `config.py` via `ConfigManager`) and uses the OpenAI API to analyze the changes and generate preliminary documentation content.
3.  The generated content is saved into Markdown files, including `ISSUES_TO_CREATE.md`.
4.  After a PR merge (or similar event), `create_issues.py` is invoked with the `ISSUES_TO_CREATE.md` file and GitHub credentials.
5.  `create_issues.py` parses the Markdown file, extracts issue details, and interacts with the GitHub API to create new issues.
6.  Finally, `create_issues.py` updates the `ISSUES_TO_CREATE.md` file to include links to the newly created GitHub issues, providing a traceable record.

## 4. Key Design Principles

*   **Modularity**: Separation of concerns between documentation generation and issue creation.
*   **External Configuration**: Use of `config.py` allows for flexible and environment-specific settings without code modification.
*   **API-Driven**: Leverages OpenAI and GitHub APIs for intelligent content generation and seamless integration with GitHub workflows.
*   **Markdown-Centric**: Uses Markdown as an intermediate format for documentation, making it human-readable and easily parsable.
*   **Traceability**: Issues are linked back to the PR and the generated documentation, ensuring a clear audit trail. 